# 10 РЕКОМЕНДАТЕЛЬНЫЙ СЕРВИС ДЛЯ ОПРЕДЕЛЕНИЯ ОПТИМАЛЬНЫХ МЕСТ РАЗМЕЩЕНИЯ ПОСТАМАТОВ В РМАКАХ ПРОЕКТА «МОСКОВСКИ ПОСТАМАТ»
## 10.1 Актуальность
Проект «Московский постамат» стал ответом на запрос москвичей в бесконтактной, быстрой и удобной системе доставки, расположенной максимально близко к жителям. Сейчас проект находится в стадии начальной реализации и в будущем нацелен на создание в Москве сети, включающей более 10 000 постаматов.

В ходе реализации проекта была обнаружена потребность в разработке сервиса, способного оценить влияние различных факторов на востребованность среди горожан размещаемого постамата.
## 10.2 Описание
Разработайте сервис для предоставления рекомендаций по оптимальному размещению постаматов в подъездах многоквартирных домов и возле городских киосков в зависимости от уникальных условий местности.

## 10.3 Стек технологий для реализации
- [API Yandex Maps](https://yandex.ru/dev/delivery-3/doc/dg/reference/put-pickup-points.html?lang=ru)
- [Python Flask](https://flask.palletsprojects.com/en/2.2.x/)
- [Bootstrap](https://getbootstrap.com/docs/5.2/examples/)
- [gRPC](https://grpc.io/)

## 10.4 Архитектура проекта
Проект представляет собой 2 микросервиса, запущенных на одном физическом сервере.  

Микросервис номер 1 осуществляет запросы к api yandex maps, затем осуществляет расчет оптимального размещения постаматов и по запросу от микросервиса номер 2 отдает ему полученные данные.  

Микросервис номер 2 ожидает пользовательские запросы через веб интерфейс, после получения запроса, обращается к микросервису номер 1 с просьбой выдать актуальные данные, получив данные от микросервиса номер 2, данные рендерятся через веб интерфейс пользователю.
Для того, чтобы уменьшить время ожидания от сервиса номер 1, данные о размещении постаматов желательно кешировать. Кешированные данные должны иметь срок годности, например 24 часа, поскольку установить постамат быстрее, я думаю, физически не возможно.  

Микросервис номер 2 предлагаю реализовать на python, используя фреймворк flask. Это легкий в использовании, весьма производительный движок для веб сервисов, к которому можно прикрутить веб морду bootstrap.  

Микросервис номер 1, для скорости реализации, предлагаю так-же реализовать на python.  

Обмен данными между микросервисом номер 1 и 2 предлагаю реализовать с помощью протокола gRPC, который в отличие от REST API использует протокол http версии 2.0, что производительнее. Использование сетевого протокола обмена данными позволит разнести микросервисы на разные физические сервера, что в будущем будет способствовать лучшей маштабируемости, отказоустойчивости и наблюдаемости проекта.  

Реализация микросервиса номер 2 в виде веб сервиса упростит использование пользователям, не нужно будет устанавливать дополнительное ПО, а так же проект становится автоматически кросс-платформенным. Такая архитектура позволит в будущем руализовать api у сервиса, чтобы клиенты сервиса могли интегрировать сервис в свои проекты.

## 10.5 Входные данные
Входными данными для проекта служит отмеченный пользователем на карте [полигон](https://yandex.ru/dev/maps/jsapi/doc/2.1/ref/reference/Polygon.html), желательно сделать так, чтобы пользователь мог выделить только квадрат, по которому вычисляются 4 значения lat from, lat to, long from, lat to.  
Дале из этих значений формируется запрос к yandex maps api, от которого получаем ответ вида:
```
HTTP/1.1 200 OK
Date: Tue, 11 Dec 2018 18:22:14 GMT
Content-Type: application/json;charset=utf-8
...
[
  {
    "id": 678456,
    "partnerId": 456,
    "type": "TERMINAL",
    "name": "Постамат №0",
    "instruction": "От остановки направо",
    "address": 
    {
      "locationId": 80,
      "latitude": 46.923039,
      "longitude": 142.722976,
      "postalCode": "693008",
      "locality": "Южно-Сахалинск",
      "street": "Железнодорожная",
      "house": "170Б/1",
      "housing": "2",
      "building": "26",
      "addressString": "693008, Южно-Сахалинск, Железнодорожная, д. 170Б/1, корп. 2, стр. 26",
      "shortAddressString": "Железнодорожная, д. 170Б/1, корп. 2, стр. 26"
    },
    "phones": 
    [
      {
        "type": "PRIMARY",
        "number": "+7(4812)123456",
        "internalNumber": "789"
      },
      {
        "type": "ADDITIONAL",
        "number": "+7(391)9876543",
        "internalNumber": "21"
      },
      ...
    ],
    "schedule": 
    [
      {
        "day": 1,
        "from": "08:00",
        "to": "20:00"
      },
      ...
    ],
    "contact": 
    {
      "firstName": "Василий",
      "middleName": "Иванович",
      "lastName": "Пупкин"
    },
    "supportedFeatures": 
    {
      "cash": false,
      "prepay": true,
      "card": true
    }
  },
  ...
]
```
Эти данные являются входными данными для алгоритма вычисления оптимальных мест расположения постаматов.
## 10.6 Выходные данные
Выходные это конечно заебись, понедельник в рот ебись JSon Statham.
Выходными данными для клтента являются [точки на карте](https://yandex.ru/dev/maps/jsbox/2.1/icon_customImage), расположенные внутри отмеченного ранее полигона.  
Эти точки на карте, в будущем, можно будет отдавать через api.
## 10.7 Алгоритм вычисления оптимальных мест расположения постаматов
